# 🔄 دليل نقل الحسابات بين السيرفرات - Account Transfer Guide

## 🎯 الوصف
ميزة جديدة تم إضافتها إلى سكريبت إدارة WHM تتيح لك نقل الحسابات بين السيرفرات بشكل آلي وآمن.

## 🚀 كيفية الوصول
1. شغل السكريبت: `python3 server_monitoring_script.py`
2. اختر الخيار `18. 🔄 Account transfer between servers`

## 🔧 الميزات المتاحة

### 1. 🔄 نقل حساب واحد
- نقل حساب محدد من سيرفر إلى آخر
- دعم النقل الكامل والجزئي
- نسخ احتياطية تلقائية

### 2. 📋 نقل حسابات متعددة
- نقل مجموعة من الحسابات دفعة واحدة
- تقارير مفصلة عن عملية النقل
- إدارة الأخطاء والنجاح

### 3. 🔍 فحص حالة الحساب
- فحص وجود الحساب في السيرفرين
- مقارنة حالة الحساب
- تأكيد نجاح النقل

### 4. 📊 تاريخ النقل
- تتبع عمليات النقل السابقة
- إحصائيات النجاح والفشل
- سجل مفصل للعمليات

## 📋 خطوات النقل

### المرحلة الأولى: الإعداد
```bash
1. اختيار السيرفر المصدر
2. اختيار السيرفر الهدف
3. فحص المساحة المتوفرة
4. التأكد من توافق الإصدارات
```

### المرحلة الثانية: النقل
```bash
1. إنشاء نسخة احتياطية
2. نقل النسخة الاحتياطية
3. إنشاء الحساب في السيرفر الجديد
4. استعادة الملفات والبيانات
5. تنظيف الملفات المؤقتة
```

### المرحلة الثالثة: التأكيد
```bash
1. اختبار الوصول للحساب
2. فحص قواعد البيانات
3. اختبار البريد الإلكتروني
4. اختبار الموقع
```

## 🎯 أنواع النقل

### النقل الكامل (Full Transfer)
- ✅ جميع الملفات والمجلدات
- ✅ قواعد البيانات
- ✅ إعدادات البريد الإلكتروني
- ✅ إعدادات DNS
- ✅ شهادات SSL
- ✅ إعدادات cPanel

### النقل الجزئي (Selective Transfer)
- ✅ الملفات الأساسية فقط
- ✅ قواعد البيانات المهمة
- ✅ إعدادات محددة
- ⚠️ قد يحتاج إعداد يدوي إضافي

## ⚠️ متطلبات النقل

### متطلبات السيرفر المصدر
- ✅ حساب موجود وصالح
- ✅ صلاحيات كافية للنسخ الاحتياطي
- ✅ مساحة كافية للنسخة الاحتياطية
- ✅ دعم exec/shell API (للنقل التلقائي)

### متطلبات السيرفر الهدف
- ✅ مساحة كافية للحساب
- ✅ نفس إصدارات البرامج
- ✅ صلاحيات إنشاء الحسابات
- ✅ دعم exec/shell API (للنقل التلقائي)

## 🔧 الأوامر المستخدمة

### إنشاء النسخة الاحتياطية
```bash
cd /home/username && tar -czf /tmp/username_backup_timestamp.tar.gz .
```

### نقل النسخة الاحتياطية
```bash
scp /tmp/username_backup_timestamp.tar.gz root@target_server:/tmp/
```

### استعادة الحساب
```bash
cd /home/username && tar -xzf /tmp/username_backup_timestamp.tar.gz
chown -R username:username .
rm /tmp/username_backup_timestamp.tar.gz
```

## 📊 مثال على النقل

### نقل حساب "example.com"
```bash
# 1. اختيار السيرفر المصدر: 93 (94.130.22.93)
# 2. اختيار السيرفر الهدف: 184 (65.108.6.184)
# 3. إدخال اسم المستخدم: example
# 4. نوع النقل: full
# 5. انتظار اكتمال العملية
```

### النتيجة المتوقعة
```
🎉 Account transfer completed successfully!
   📤 From: 94.130.22.93
   📥 To: 65.108.6.184
   👤 Account: example
   🌐 Domain: example.com
```

## ⚠️ تحذيرات مهمة

### قبل النقل
- ✅ **نسخة احتياطية كاملة** من السيرفر المصدر
- ✅ **فحص المساحة** في السيرفر الهدف
- ✅ **تأكد من توافق الإصدارات**
- ✅ **إيقاف الخدمات مؤقتاً** إذا لزم الأمر

### أثناء النقل
- ⏱️ **وقت النقل** يعتمد على حجم البيانات
- 🔒 **أمان البيانات** أثناء النقل
- 📊 **مراقبة التقدم** والنقل
- ⚠️ **لا توقف العملية** في المنتصف

### بعد النقل
- ✅ **اختبار الوصول** للحساب
- ✅ **فحص قواعد البيانات**
- ✅ **اختبار البريد الإلكتروني**
- ✅ **اختبار الموقع**
- ✅ **حديث DNS** إذا لزم الأمر

## 🔍 استكشاف الأخطاء

### مشاكل شائعة وحلولها

#### 1. خطأ في إنشاء النسخة الاحتياطية
```bash
❌ Cannot create backup via API
💡 Manual backup required:
   SSH to source_server and run:
   cd /home/username && tar -czf /tmp/username_backup_timestamp.tar.gz .
```

#### 2. خطأ في نقل النسخة الاحتياطية
```bash
❌ Cannot transfer via API
💡 Manual transfer required:
   SSH to source_server and run:
   scp /tmp/username_backup_timestamp.tar.gz root@target_server:/tmp/
```

#### 3. خطأ في إنشاء الحساب
```bash
❌ Cannot create account
💡 Check:
   - Available disk space
   - Package availability
   - WHM permissions
```

#### 4. خطأ في استعادة الملفات
```bash
❌ Cannot restore files
💡 Manual restore required:
   SSH to target_server and run:
   cd /home/username && tar -xzf /tmp/username_backup_timestamp.tar.gz
```

## 💡 نصائح للاستخدام

### 1. التخطيط
- **اختر وقت مناسب** (ساعات الليل)
- **أخبر العملاء** بالتوقف المؤقت
- **احسب الوقت المطلوب** للنقل

### 2. الأمان
- **استخدم SSH keys** للاتصال بين السيرفرات
- **احتفظ بالنسخ الاحتياطية** لفترة
- **اختبر كل شيء** بعد النقل

### 3. المراقبة
- **راقب استخدام القرص** أثناء النقل
- **تحقق من سجلات النظام** للبحث عن أخطاء
- **اختبر الأداء** بعد النقل

### 4. الصيانة
- **نظف الملفات المؤقتة** بعد النقل
- **حديث DNS** إذا لزم الأمر
- **أعد تشغيل الخدمات** إذا لزم الأمر

## 🔗 روابط مفيدة

- **WHM Transfer Tool**: `WHM > Transfers > Transfer Tool`
- **cPanel File Manager**: لإدارة الملفات
- **phpMyAdmin**: لإدارة قواعد البيانات
- **WHM API Documentation**: للبرمجة المتقدمة

## 📞 الدعم

إذا واجهت أي مشاكل:
1. راجع سجلات السكريبت
2. تحقق من صلاحيات WHM API
3. تأكد من توفر المساحة
4. اختبر الاتصال بين السيرفرات
5. استخدم الأوامر اليدوية كحل بديل

---

**ملاحظة**: هذه الميزة تتطلب صلاحيات كاملة على كلا السيرفرين. تأكد من أن لديك الصلاحيات المناسبة قبل الاستخدام.
